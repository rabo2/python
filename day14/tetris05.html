<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
<script type="text/javascript">
var block2D = [
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0]
  
];
var stack2D = [
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0]
  
];
var scrin2D = [
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],

  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0],
  [0,0,0,0,0, 0,0,0,0,0]
  
];
class Block {
  constructor(type,status,i,j){
	 this.type=type;
	 this.status = status;
	 this.i = i;
	 this.j = j;
  }
}

// (순번, 방향, 2, 2)
var b = new Block(1,1,2,2);
var game_flag = false;

function setBlock2DFromClass(){
  
  for(var i=0; i<block2D.length;i++){
	 for(var j=0;j<block2D[i].length;j++){
		if(block2D[i][j]>0){
		   block2D[i][j] = 0;
		}
	 }   
  }
  
  
  //1

  // 1 1
  // 1 1
  if(b.type == 1){
	 block2D[b.i      ][b.j   ]=b.type;
	 block2D[b.i      ][b.j+1   ]=b.type;
	 block2D[b.i+1   ][b.j   ]=b.type;
	 block2D[b.i+1   ][b.j+1   ]=b.type;
  }


  //2
  if(b.type == 2){
  
	 // 2
	 // 2 2
	 //   2
  
	 if(b.status ==1){
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
		block2D[b.i+1   ][b.j+1   ]=b.type;
	 }
  
	 //   2 2
	 // 2 2
	 if(b.status == 2){
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
		block2D[b.i+1   ][b.j-1   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
	 
	 }
  }

  //3

  //   3
  // 3 3
  // 3
  if(b.type == 3){
	 if(b.status ==1){
		block2D[b.i-1   ][b.j+1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
	 }
	 // 3 3
	 //   3 3
	 if(b.status == 2){
		block2D[b.i-1   ][b.j-1   ]=b.type;
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
	 }
  }
  //4

  // 4 4 4 4
  if(b.type == 4){
		if(b.status ==1){
		block2D[b.i      ][b.j-1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
		block2D[b.i      ][b.j+2   ]=b.type;
	 }
	 // 4
	 // 4
	 // 4
	 // 4
	 
	 if(b.status == 2){
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
		block2D[b.i+2   ][b.j   ]=b.type;
	 }
  }
  //5
  
  // 5 5
  // 5
  // 5
  if(b.type == 5){
	 if(b.status ==1){
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i-1   ][b.j+1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
	 }
	 // 5 5 5
	 //     5
	 if(b.status == 2){
		block2D[b.i      ][b.j-1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
		block2D[b.i+1   ][b.j+1   ]=b.type;
	 }
	 //   5
	 //   5
	 // 5 5
	 if(b.status == 3){
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i+1   ][b.j-1   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
	 }
	 // 5
	 // 5 5 5
	 if(b.status == 4){
		block2D[b.i-1   ][b.j-1   ]=b.type;
		block2D[b.i      ][b.j-1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
	 }
  }
  //6
  
  if(b.type == 6){
	 // 6 6
	 //   6
	 //   6
	 if(b.status ==1){
		block2D[b.i-1   ][b.j-1   ]=b.type;
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
	 }
	 //     6
	 // 6 6 6
	 if(b.status == 2){
		block2D[b.i-1   ][b.j+1   ]=b.type;
		block2D[b.i      ][b.j-1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
	 }
	 // 6
	 // 6
	 // 6 6
	 if(b.status == 3){
		block2D[b.i-1   ][b.j   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i+1   ][b.j   ]=b.type;
		block2D[b.i+1   ][b.j+1   ]=b.type;
	 }
	 // 6 6 6
	 // 6
	 if(b.status == 4){
		block2D[b.i      ][b.j-1   ]=b.type;
		block2D[b.i      ][b.j   ]=b.type;
		block2D[b.i      ][b.j+1   ]=b.type;
		block2D[b.i+1   ][b.j-1   ]=b.type;
	 }
  }
  
  if(b.type == 7){
	 if(b.status==1){            
		block2D[b.i     ][b.j   ]=b.type;
		   block2D[b.i-1    ][b.j   ]=b.type;
		   block2D[b.i     ][b.j-1 ]=b.type;
		   block2D[b.i     ][b.j+1 ]=b.type;
	   }
		if(b.status==2){            
		   block2D[b.i     ][b.j   ]=b.type;
		   block2D[b.i-1    ][b.j   ]=b.type;
		   block2D[b.i+1    ][b.j     ]=b.type;
		   block2D[b.i     ][b.j+1 ]=b.type;
		}
		if(b.status==3){            
		   block2D[b.i     ][b.j   ]=b.type;
		   block2D[b.i      ][b.j-1 ]=b.type;
		   block2D[b.i      ][b.j+1 ]=b.type;
		   block2D[b.i+1    ][b.j   ]=b.type;
		}
		if(b.status==4){            
		   block2D[b.i     ][b.j   ]=b.type;
		   block2D[b.i-1    ][b.j   ]=b.type;
		   block2D[b.i     ][b.j-1 ]=b.type;
		   block2D[b.i+1    ][b.j   ]=b.type;
		}
   }
}

function moveBlock2DToScrin2D(){
  for(var i=0; i<block2D.length;i++){
	 for(var j=0;j<block2D[i].length;j++){
		if(block2D[i][j]>0){
		   scrin2D[i][j] = block2D[i][j];
		}
	 }   
  }
}

function moveStack2DToScrin2D(){
  for(var i=0; i<stack2D.length;i++){
	 for(var j=0;j<stack2D[i].length;j++){
		if(stack2D[i][j]>0){
		   scrin2D[i][j] = stack2D[i][j];
		}
	 }   
  }
}
function myrender(){
  var tds = document.getElementsByTagName("td");
  
  for(var i=0;i<scrin2D.length;i++){
	 for(var j=0;j<scrin2D[i].length;j++){
		if(scrin2D[i][j]==0){
		   tds[i*10+j].bgColor = "white";
		}
		if(scrin2D[i][j]==1){
		   tds[i*10+j].bgColor = "Red";
		}
		if(scrin2D[i][j]==2){
		   tds[i*10+j].bgColor = "Orange";
		}
		if(scrin2D[i][j]==3){
		   tds[i*10+j].bgColor = "Yellow";
		}
		if(scrin2D[i][j]==4){
		   tds[i*10+j].bgColor = "Green";
		}
		if(scrin2D[i][j]==5){
		   tds[i*10+j].bgColor = "Blue";
		}
		if(scrin2D[i][j]==6){
		   tds[i*10+j].bgColor = "Purple";
		}
		if(scrin2D[i][j]==7){
		   tds[i*10+j].bgColor = "Pink";
		}
		
		if(scrin2D[i][j]==11){
		   tds[i*10+j].bgColor = "00ff00";
		}
		if(scrin2D[i][j]==12){
		   tds[i*10+j].bgColor = "00dd00";
		}
		if(scrin2D[i][j]==13){
		   tds[i*10+j].bgColor = "00bb00";
		}
		if(scrin2D[i][j]==14){
		   tds[i*10+j].bgColor = "009900";
		}
		if(scrin2D[i][j]==15){
		   tds[i*10+j].bgColor = "007700";
		}
		if(scrin2D[i][j]==16){
		   tds[i*10+j].bgColor = "005500";
		}
		if(scrin2D[i][j]==17){
		   tds[i*10+j].bgColor = "003300";
		}
	 }
  }
}

function changeStatus(){
   if(b.type > 1 && b.type < 5){
		if(b.status == 1){
		   b.status = 2;
		}else{
		   b.status = 1;
		}
	 }else if(b.type >= 5){
		   b.status++;
		   if(b.status > 4){
			  b.status = 1;
		   }
	 }
}


function makeScrin2DZero(){
  for(var i=0; i<scrin2D.length;i++){
	 for(var j=0;j<scrin2D[i].length;j++){
		if(scrin2D[i][j]>0){
		   scrin2D[i][j] = 0;
		}
	 }   
  }
}

function isCollision(){
  var cnt = 0;
  for(var i=0; i<25;i++){
	 for(var j=0;j<10;j++){
		if(block2D[i][j]>0){
		   cnt++;
		}
	 }
  }
  if(cnt<4){
	 return true;
  }
  for(var i=0; i<block2D.length;i++){
	 for(var j=0;j<block2D[i].length;j++){
		if(block2D[i][j]>0 && stack2D[i][j]>0){
		   return true;
		}
	 }
  }
  return false;
}

function stackBlock(){
  for(var i=0; i<block2D.length;i++){
	 for(var j=0;j<block2D[i].length;j++){
		if(block2D[i][j]>0){
		   stack2D[i][j] = block2D[i][j]+10;
		}
	 }
  }
}

function getCount10(){
  var cnt = 0
  for(var i=0; i<stack2D.length;i++){
	 if(stack2D[i][0] > 0 &&
		stack2D[i][1] > 0 &&
		stack2D[i][2] > 0 &&
		stack2D[i][3] > 0 &&
		stack2D[i][4] > 0 &&
		stack2D[i][5] > 0 &&
		stack2D[i][6] > 0 &&
		stack2D[i][7] > 0 &&
		stack2D[i][8] > 0 &&
		stack2D[i][9] > 0){
		cnt++;
	 }
  }
  return cnt;
}

function remove10Stack(){
   var snew = [];
	 
	var cnt = 0;
	for(var i = 0; i < stack2D.length; i++){
	   if(stack2D[i][0] > 0 && 
		 stack2D[i][1] > 0 &&
		 stack2D[i][2] > 0 &&
		 stack2D[i][3] > 0 &&
		 stack2D[i][4] > 0 &&
		 stack2D[i][5] > 0 &&
		 stack2D[i][6] > 0 &&
			 stack2D[i][7] > 0 &&
			 stack2D[i][8] > 0 &&
			 stack2D[i][9] > 0
			 ){
		   cnt++;
		}else{
		   snew.push(stack2D[i]+"")
		}
	 } 
	 
	 for(var i = 0; i < cnt; i++){
		snew.unshift("0,0,0,0,0,0,0,0,0,0");
	 }
	 
	 for(var i=0; i<snew.length;i++){
	  var temp = snew[i];
	  var arr10 = temp.split(",");
	  stack2D[i][0]=parseInt(arr10[0]);
	  stack2D[i][1]=parseInt(arr10[1]);
	  stack2D[i][2]=parseInt(arr10[2]);
	  stack2D[i][3]=parseInt(arr10[3]);
	  stack2D[i][4]=parseInt(arr10[4]);
	  stack2D[i][5]=parseInt(arr10[5]);
	  stack2D[i][6]=parseInt(arr10[6]);
	  stack2D[i][7]=parseInt(arr10[7]);
	  stack2D[i][8]=parseInt(arr10[8]);
	  stack2D[i][9]=parseInt(arr10[9]);
	  
	}
}

function scoreDown(){
  var elem = document.getElementById("mydisplay");
  console.log(elem.innerHTML);
//       var cnt10 = getCount10();
//       b = b-cnt10;
//       return b;
}

function isfull(){
	for(var i = 0; i < 10; i++){
		if(stack2D[6][i] > 0){
			return true;
		}
	}
	return false;
}


function mydown(key){
  if(game_flag){
	  return;
  }
  var bak_type    = b.type;
  var bak_status    = b.status;
  var bak_i       = b.i;
  var bak_j       = b.j;
  
  var flag_down = false;
  
  if(key=="ArrowUp"){
	 changeStatus();
  }else if(key=="ArrowDown"){
	 b.i++;
	 flag_down = true;
  }else if(key=="ArrowLeft"){
	 b.j--;
  }else if(key=="ArrowRight"){
	 b.j++;
  }
  
  try{
	 setBlock2DFromClass();
  } catch (error){
	 console.log("에러나면 여기");
  }
  
  var flag_collision = isCollision();
  
  if(flag_collision){
	 b.type      = bak_type;
	 b.status   = bak_status;
	 b.i         = bak_i;
	 b.j         = bak_j;
	 setBlock2DFromClass();
	 if(flag_down){
		stackBlock();
		
		var cnt10 = getCount10();
		if(cnt10 > 0){
			remove10Stack();
			var obj_disp = document.getElementById('mydisplay');
			var str_cnt = obj_disp.innerHTML;
			var int_cnt = parseInt(str_cnt);
			var total = int_cnt - cnt10 + "";
			
			obj_disp.innerHTML = total;

			if(total <= 0){
				alert('You Win');
			}
		}
		scoreDown();
		
//        	b.type      = parseInt(Math.random()*7)+1;
		b.type      = 1;
		b.status   = 1;
		b.i         = 2;
		b.j         = 2;
		setBlock2DFromClass();
	 }
  }

  makeScrin2DZero();
  moveBlock2DToScrin2D();
  moveStack2DToScrin2D();
  
  myrender();
  
  var flag_full = isfull();
  if(flag_full){
	  alert('Game Over!');
	  game_flag = true;
  }
}

window.addEventListener("keydown", (e) => {
  mydown(e.key);
})

</script>
<style type="text/css">
table{
   border: 0px;
   margin: 0px;
   padding: 0px;
   border-collapse: collapse;
}
tr{
   border: 0px;
   margin: 0px;
   padding: 0px;
}
td{
   width: 20px;
   height: 20px;
}
</style>
</head>
<body>

<table border="1px;">
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
   <tr>
      <td></td><td></td><td></td><td></td><td></td>
      <td></td><td></td><td></td><td></td><td></td>
   </tr>
</table>
점수 : <div id="mydisplay">1</div>

</body>
</html>